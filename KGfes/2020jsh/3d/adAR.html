<!DOCTYPE html>
<!--HTML5-->
<html lang="ja">

<head>
    <!-- meta設定 -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="Content-Script-Type" content="text/javascript" charset="UTF-8" />
    <meta http-equiv="Content-Style-Type" content="text/ccs" charset="UTF-8" />
    <meta name="robots" content="noindex,nofollow" />

    <!-- Global site tag (gtag.js) - Google Analytics by KG-->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116915593-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'UA-116915593-1');
    </script>


    <!-- JS/CSS master -->
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script
        src="https://unpkg.com/aframe-particle-system-component@1.1.3/dist/aframe-particle-system-component.min.js"></script>
    <title>五峯祭へお越しください！</title>
</head>

<body>
    <div class="arjs-loader">
        <div>Loading, please wait...</div>
    </div>
    <script>


        AFRAME.registerComponent('registerevents', {
            init: function () {
                let marker = this.el;
                // Make the element emit events when found and when lost.
                marker.setAttribute('emitevents', 'true');

                marker.addEventListener('markerFound', function () {
                    // TODO: Add your own code here to react to the marker being found.
                    //指定idのオブジェクトにイベント発火
                    document.querySelector('#markerFounderWrap').emit('markerFound');
                    document.querySelector('#markerFoundAnimation').emit('markerFound0');
                });

                marker.addEventListener('markerLost', function () {
                    // TODO: Add your own code here to react to the marker being lost.
                });
            }
        });

    </script>
    <a-scene id="myGallery" embedded arjs="trackingMethod:best;debugUIEnabled:false;">
        <a-assets>
            <!-- 書き方例 
            <a-asset-item id="myId" src="myId.mtl"></a-asset-item>
            <a-mixin id="mixin" scale="5 5 5"></a-mixin>
            <audio id="audio" src="audio.mp3"></audio>
            <img id="img" src="img.png">
            <video id="video" src="video.mp4"></video>
            -->
            <!--
            <a-asset-item id="5mine-obj" src="obj/taitorunomoji.obj"></a-asset-item>
            <a-asset-item id="5mine-mtl" src="obj/taitorunomoji.mtl"></a-asset-item>
            -->
        </a-assets>
        <a-marker type='pattern' url='./marker/pattern-QR_fes2020jsh.patt' id="IamMarker" registerevents>

            <a-entity id="markerFoundAnimation" class="markerFoundAnime" scale="0 0 0" animation__mkfound="property:scale;
            to:1 1 1;
            easing:easeOutElastic;dur:1000;
            startEvents:markerFound0;">
                <a-entity id="imgWrapRotR" animation="property: rotation;
                            to: 0 -360 0;
                            easing:linear;
                            dur:6000;
                            loop:true;">
                    <a-entity animation="property:rotation;to:1980 1800 1800;dur:1000;">
                        <!--<a-circle color="transparent" radius="1" wireframe="true"></a-circle>-->
                    </a-entity>
                    <a-entity line="start:1 0 0;end:0 0 1;color:white;" line__1="start:0 0 1;end:-1 0 0;color:white;"
                        line__2="start:-1 0 0;end:0 0 -1;color:white;" line__3="start:0 0 -1;end:1 0 0;color:white;">
                    </a-entity>
                </a-entity>
                <a-entity id="imgWrapRotL" animation="property: rotation;
                            to: 0 360 0;
                            easing:linear;
                            dur:6000;
                            loop:true;">
                    <a-entity line="start:1 0 0;end:0 0 1;color:white;" line__1="start:0 0 1;end:-1 0 0;color:white;"
                        line__2="start:-1 0 0;end:0 0 -1;color:white;" line__3="start:0 0 -1;end:1 0 0;color:white;">
                    </a-entity>
                </a-entity>
            </a-entity>
            <a-entity id="markerFounderWrap" class="markerFoundAnime" scale="0 0 0" animation__mkfound="property:scale;
            to:1.0 1.0 1.0;
            easing:easeInCubic;
            delay:1000;dur:1500;
            startEvents:markerFound;">
                <!-- 回転ギャラリー -->
                <a-entity id="imgWrap" animation="property:rotation;
                to:0 360 0;loop:true;dur:36000;easing:linear;"></a-entity>
                <!-- Popupギャラリー -->
                <a-entity id="imgWrap2"></a-entity>


                <a-entity animation="property:rotation;to:0 360 0;loop:true;dur:12000;easing:linear;">
                    <!--
                    <a-obj-model src="#5mine-obj" mtl="#5mine-mtl" position="0 -0.5 1.5" scale=".3 .3 .3" rotation="-30 0 0"></a-obj-model>
                -->
                    <a-obj-model src="obj/taitorunomoji.obj" mtl="obj/taitorunomoji.mtl" position="0 0.5 3"
                        scale=".3 .3 .3" rotation="-30 0 0"></a-obj-model>
                </a-entity>
            </a-entity>
            <a-entity particle-system="preset:star;
                                 size:2;color: #FFFF00,#FF8800;opacity:1;blending:1;
                                 velocityValue:0 0 0;velocitySpread:1 2 1;
                                 positionSpread:5 0 5;
                                 particleCount:100;" position="0 20 0"></a-entity>
            <a-entity id="z-axis" position="0 0.5 0"></a-entity>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>
    <script>
        //画像セット
        (function () {
            let imgWrap = document.getElementById("imgWrap");
            let r = 1.8;
            let img = [
                "obj/poster0.png",
                "obj/poster1.png",
                "obj/poster2.png",
                "obj/poster3.png",

                "obj/poster0.png",
                "obj/poster1.png",
                "obj/poster2.png",
                "obj/poster3.png",

                "obj/poster0.png",
                "obj/poster1.png",
                "obj/poster2.png",
                "obj/poster3.png"
            ];
            let lv = Math.ceil(img.length / 6);   //段数取得・・・どうやってconeにする？
            for (let i = 0; i < img.length; i++) {
                let ele = document.createElement("a-image");

                ele.setAttribute("scale", "1.5 1.5 1.5");
                ele.setAttribute("src", img[i]);
                ele.setAttribute("side", "double");
                ele.setAttribute("position",
                    r * Math.sin(i / 6 * 2 * Math.PI) + " " +
                    Math.floor(i / 6) * 2.3 + " " +
                    r * Math.cos(i / 6 * 2 * Math.PI)
                );
                ele.setAttribute("rotation", "-30 " + i * 60 + " 0");
                //ele.setAttribute("color", "#0f0");
                ele.setAttribute("opacity", "0.9");
                imgWrap.appendChild(ele);
            }

            let imgWrap2 = document.getElementById("imgWrap2");
            let dur = 2000;
            for (let i = 0; i < img.length; i++) {
                let ele = document.createElement("a-image");
                ele.setAttribute("src", img[i]);
                ele.setAttribute("side", "double");
                ele.setAttribute("rotation", "-90 0 0");
                ele.setAttribute("position", "0 0 0");
                ele.setAttribute("opacity", "0");
                ele.setAttribute("scale", "0.1 0.1 0.1");
                //時差
                ele.setAttribute("animation__starter",
                    "property:opacity;to:0;" +
                    "dur:" + (dur * i) + ";")
                //popup
                ele.setAttribute("animation__pos0",
                    "property:position;" +
                    "to:0 3 0;" +
                    "easing:easeOutElastic;" +
                    "dur:" + dur + ";" +
                    "startEvents:animationcomplete__starter,animationcomplete__pos2;");
                ele.setAttribute("animation__scale0",
                    "property:scale;" +
                    "to:1.5 1.5 1.5;" +
                    "easing:easeOutElastic;" +
                    "dur:" + dur + ";" +
                    "startEvents:animationcomplete__starter,animationcomplete__pos2;");
                ele.setAttribute("animation__opacity0",
                    "property:opacity;" +
                    "to:1.0;" +
                    "easing:easeOutElastic;" +
                    "dur:" + dur + ";" +
                    "startEvents:animationcomplete__starter,animationcomplete__pos2;");
                //popdown
                ele.setAttribute("animation__pos1",
                    "property:position;" +
                    "to:0 0 0;" +
                    "easing:easeOutCubic;" +
                    "dur:" + dur + ";" +
                    "startEvents:animationcomplete__pos0;");
                ele.setAttribute("animation__scale1",
                    "property:scale;" +
                    "to:0.1 0.1 0.1;" +
                    "easing:easeOutCubic;" +
                    "dur:" + dur + ";" +
                    "startEvents:animationcomplete__pos0;");
                ele.setAttribute("animation__opacity1",
                    "property:opacity;" +
                    "to:0.0;" +
                    "easing:easeOutElastic;" +
                    "dur:" + dur + ";" +
                    "startEvents:animationcomplete__pos0;");
                //wait
                ele.setAttribute("animation__pos2",
                    "property:position;" +
                    "to:0 0 0;" +
                    "dur:" + dur * (img.length - 2) + ";" +
                    "startEvents:animationcomplete__pos1;");

                imgWrap2.appendChild(ele);
            }
        }());

    </script>
</body>

</html>